<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Strava Rides</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 1rem;
    }
    h1 {
      font-size: 1.5rem;
    }
    .ride-card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 0.75rem;
      margin-bottom: 1rem;
      background: #f9f9f9;
    }
  </style>
</head>
<body>
  <h1>Your Recent Bike Rides</h1>
  <div id="ride-list"></div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const sessionId = params.get("session_id");

    if (!sessionId) {
      document.body.innerHTML = "<p>Session ID missing in URL.</p>";
    } else {
      fetch(`https://strava-csv-backend-production.up.railway.app/activities?session_id=${sessionId}`)
        .then(res => res.json())
        .then(data => {
          const list = document.getElementById("ride-list");

          if (data.error) {
            list.innerHTML = `<p>${data.error}</p>`;
            return;
          }

          data.forEach(ride => {
            const item = document.createElement("div");
            item.className = "ride-card";

            const date = new Date(ride.start_date).toLocaleDateString();
            const distanceKm = (ride.distance / 1000).toFixed(1);
            const speed = ride.average_speed?.toFixed(1) || "N/A";
            const heartrate = ride.average_heartrate ? `${ride.average_heartrate} bpm` : "N/A";
            const kudos = ride.kudos_count ?? 0;
            const elevation = ride.total_elevation_gain ?? 0;
            const type = ride.sport_type ?? ride.type ?? "Ride";

            item.innerHTML = `
              <strong>${ride.name}</strong><br/>
              ${distanceKm} km • ${date}<br/>
              Speed: ${speed} m/s • HR: ${heartrate}<br/>
              Kudos: ${kudos} • Elevation Gain: ${elevation} m<br/>
              Type: ${type}
            `;

            list.appendChild(item);
          });
        })
        .catch(err => {
          document.body.innerHTML = `<p>Failed to load activities. ${err.message}</p>`;
        });
    }
  </script>
</body>
</html>
